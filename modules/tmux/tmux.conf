set -gu default-command # override the tmux-sensible changes
set -g default-shell "$SHELL" # sometimes noticing bugs when tmux starts with bash

set-option -g prefix C-a
bind-key C-a last-window
bind-key a send-prefix # allows nested `C-a` by doing `C-a a`

set -g base-index 1 # start numbering at 1
set -s escape-time 0 # faster key repetition

setw -g aggressive-resize on # restrict window size per WINDOW not SESSION
set -g renumber-windows on # fix numbers when closing windows in the middle

setw -g monitor-activity on
set -g visual-activity on

bind-key C command-prompt -p "Name of new window: " "new-window -n '%%'" # new window w/ name
bind C-x setw synchronize-panes # sync key presses across all panes in window
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded..."

set-option -wg automatic-rename off # disable; `set-window-option -g automatic-rename` to enable

set-window-option -g mode-keys vi
bind-key -Tcopy-mode-vi v send -X begin-selection
bind-key -Tcopy-mode-vi y send -X copy-selection-and-cancel
bind-key y select-layout even-horizontal
bind-key u select-layout even-vertical

bind N display-popup -E "nixrb"

# tmux-sessionizer
bind f display-popup -E "tms"
bind s display-popup -E "tms switch"
bind w display-popup -E "tms windows"

bind-key -T copy-mode-vi : run "tmux split-window -h -l 3 -b 'bash -c \"seq $(tput lines) -1 1; sleep 5; clear\"'; tmux last-pane; sleep 0.15"

# https://github.com/mrjones2014/smart-splits.nvim
# Smart pane switching with awareness of Neovim splits.
bind-key -n C-h if -F "#{@pane-is-vim}" 'send-keys C-h'  'select-pane -L'
bind-key -n C-j if -F "#{@pane-is-vim}" 'send-keys C-j'  'select-pane -D'
bind-key -n C-k if -F "#{@pane-is-vim}" 'send-keys C-k'  'select-pane -U'
bind-key -n C-l if -F "#{@pane-is-vim}" 'send-keys C-l'  'select-pane -R'

tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if -F \"#{@pane-is-vim}\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if -F \"#{@pane-is-vim}\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
